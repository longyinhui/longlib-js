(function(q,l,p){var n=function(a,d,b,c,e,g){e&&(f=q.extend(f,e));if(g)switch(g){case "simplified":f=q.extend(f,v)}"string"===typeof b&&(b=JSON.parse(b));"string"===typeof c&&(c=JSON.parse(c));this.init(a,d,b,c)};n.all={};n.lock=!1;n.prototype={_parentNode:null,_editable:!1,enabled:!0,id:null,lineNoColumn:null,width:null,height:null,onBeforeNewRow:null,onNewRow:null,onSelect:null,enableRowStatus:!0,enableSorting:!0,sortBy:null,sortOrder:null,pagingType:null,goToPage:null,pageSize:0,pageNum:0,pageDirection:"x",
recordCount:0,frozenHead:!0,PKEditable:!1,concurMode:!0,columns:null,rows:null,buttons:null,allCells:{},$:null,$head:null,$foot:null,$top:null,$bottom:null,$paging:null,init:function(a,d,b,c){n.all[a]=this;this.id=a;a=b[f.defaultAttributes];this.width=a.width;this.height=a.height;this.onBeforeNewRow=a.onBeforeNewRow;this.onNewRow=a.onNewRow;this.onSelect=a.onSelect;this.pagingType=a.pagingType;this.pageSize=a.pageSize;this.pageDirection=a.pageDirection?a.pageDirection:"x";this.goToPage=a.goToPage;
this.enableSorting="undefined"===typeof a.enableSorting?!0:a.enableSorting;this.enableRowStatus="undefined"===typeof a.enableRowStatus?!0:a.enableRowStatus;this.buttons=b[f.defaultButtons];this.columns=b[f.defaultColumns];this.rows=c;if(this._parentNode=l.getElementById(d))this.width&&(this._parentNode.style.width=this.width),this._parentNode.className=f.gridDivClass,this._initColumns(),this._initHeight(),this._load(),this._initPaging(),this._initEvents(),this._initGridButtons()},_initColumns:function(){if(this.columns&&
!(0>=this.columns.length)){var a,d,b,c;for(a=0;a<this.columns.length;a++)if(b=this.columns[a],c=b.type,"undefined"===typeof b.enableSorting&&(b.enableSorting=!0),"lineno"==c)this.lineNoColumn=b.name,b.enableSorting=!1;else{switch(c){case "button":case "jsonform":var e="",g,h,k;if(b.buttons&&"string"!=typeof b.buttons)for(g="width:"+90/b.buttons.length+"%",d=0;d<b.buttons.length;d++)"jsonform"==c?(h="...",k=q.JsonForm?'JsonForm.dataGridJsonForm("'+this.id+'",{0},"'+b.name+'")':"alert('Can not find JsonForm function!')"):
(h=b.buttons[d].caption?b.buttons[d].caption:"Button",k=b.buttons[d].onclick?b.buttons[d].onclick+"(#)":""),b.buttons[d].width&&(g="width:"+b.buttons[d].width+"px"),e+="<input class='dg-button' type='button' value='"+h+"' onclick='"+k+"' style='"+g+"'/>";else g="width:90%",h=b.caption?b.caption:"Button",k=b.onclick?b.onclick+"(#)":"",e+="<input class='dg-button' type='button' value='"+h+"' onclick='"+k+"' style='"+g+"'/>";b.enableSorting=!1;b.buttons=e;break;case "hidden":b.type="label";b.hidden=
1;break;case "select":if(e="","object"===typeof b.options){e="<select>";for(d=0;d<b.options.length;d++)e+="<option value='"+b.options[d].value+"'>"+b.options[d].text+"</option>";e+="</select>";b.select=e}}if(!this._editable)switch(c){case "text":case "date":case "datetime-local":case "time":case "number":case "email":case "tel":case "url":case "select":case "textarea":case "checkbox":case "radio":this._editable=!0}b.validate&&this._initColumnValidation(a)}}},_initHeight:function(){if("auto"==this.height){var a=
this._parentNode.getBoundingClientRect().top+l.body.scrollTop;this.height=(q.top.calcFrameHeight?q.top.calcFrameHeight():q.offsetHeight)-a-f.autoBottomMargin}},_initPaging:function(){if(this.pageSize&&(this.pageSize=parseInt(this.pageSize))&&!isNaN(this.pageSize)&&(this.goToPage&&(this.pagingType="custom"),this.pagingType||(this.pagingType="online"),"y"!=this.pageDirection)){var a=function(a,b,d){var c=[],e="",g,f;g=Math.floor(b/2);if(a<=b+1)for(f=1;f<=a;f++)c.push(f);else if(d<=g+1)for(f=1;f<=b;f++)c.push(f);
else if(d<=a-g)for(f=d-g;f<=d+g;f++)c.push(f);else for(f=a-b+1;f<=a;f++)c.push(f);if(0!=c.length){for(f=0;f<c.length;f++)e=c[f]==d?e+("<span>"+c[f]+"</span> "):e+("<a>"+c[f]+"</a> ");2<c[0]&&(e="... "+e);1<c[0]&&(e="<a>1</a> "+e);c[c.length-1]<a-1&&(e+="... ");c[c.length-1]<a&&(e+="<a>"+a+"</a> ");return e}},d=function(c){c=parseInt(c);if(!(isNaN(c)||1>c||c>b.pageCount)){if("offline"!=b.pagingType){var e=l.forms[0];if(!e.pageno){alert("pageno field is not defined in form.");return}e.pageno.value=
c}"online"==b.pagingType&&e.submit();"custom"==b.pagingType&&b.goToPage&&eval(b.goToPage+"("+c+")");"online"!=b.pagingType&&(b.pageNum=c,e=l.getElementById(b.id+"_paginglinks"),e.innerHTML=a(b.pageCount,f.adjPageLinkCount,c),e.bind("click",function(a){d((a.srcElement?a.srcElement:a.target).innerText)}),l.getElementById(b.id+"_paginginput").value=c);"offline"==b.pagingType&&b._reload()}};this.$paging=l.createElement("div");this.$paging.className=f.bottomDivClass;"online"==this.pagingType||"custom"==
this.pagingType?(this.pageNum=parseInt(this.rows.pageno),this.pageCount=parseInt(this.rows.totalpages),this.recordCount=parseInt(this.rows.totalrows),isNaN(this.pageNum)&&(this.pageNum=0),isNaN(this.pageCount)&&(this.pageCount=0),isNaN(this.recordCount)&&(this.recordCount=0)):(this.pageNum=1,this.pageCount=Math.ceil(this.rows.length/this.pageSize),this.recordCount=this.rows.length);var b=this,c=this.pageCount,e=f.adjPageLinkCount,g=this.pageNum;isNaN(c)||isNaN(e)||isNaN(g)||(e="<span id='"+b.id+"_paginglinks'>"+
a(c,e,g)+"</span>",e="<span id='"+b.id+"_pagingprev' class='"+f.prevPageClass+"'>&nbsp;</span> "+e,e+="<span id='"+b.id+"_pagingnext' class='"+f.nextPageClass+"'>&nbsp;</span> ",e+="<input id='"+b.id+"_paginginput' type='text' value="+g+"> / "+c+" ",e="<div class='"+f.pagingClass+"' unselectable='none' onselectstart='return false;'>"+e+"</div>",this.$paging.innerHTML=e,this._parentNode.appendChild(this.$paging),l.getElementById(b.id+"_paginglinks").bind("click",function(a){d((a.srcElement?a.srcElement:
a.target).innerText)}),l.getElementById(this.id+"_paginginput").bind("keydown",function(a){13==(a.keyCode?a.keyCode:a.which)&&(a=parseInt(this.value),isNaN(a)||1>a||a>this.pageCount?this.value="":d(a))}),l.getElementById(b.id+"_pagingprev").onclick=function(){d(b.pageNum-1)},l.getElementById(b.id+"_pagingnext").onclick=function(){d(b.pageNum+1)})}},_initEvents:function(){var a=this,d,b;this.$.bind("click",function(c){if(a.enabled)if(n.lock)n.lock.focus&&n.lock.focus();else{c=c.srcElement?c.srcElement:
c.target;var e=c.nodeName.toLowerCase();if("span"==e)d=c.parentNode;else if("input"!=e||"radio"!=c.type.toLowerCase()&&"checkbox"!=c.type.toLowerCase())if("td"==e)d=c;else return;else d=c.parentNode;b=a.allCells[d.id];b._onClick();a.onSelect&&b&&eval(a.onSelect+"("+b.parentRow.rowIndex+")")}});this.$head.bind("click",function(c){if(a.enabled)if(n.lock)n.lock.focus&&n.lock.focus();else{var d=c.srcElement?c.srcElement:c.target,e=d.nodeName.toLowerCase();if("th"==e){var e=d.parentNode.childNodes,f=c.offsetY<
d.clientHeight/2;if(d.className&&"dg-th"!=d.className&&(b=a.allCells[d.getAttribute("name")])){a.sort(a.columns[b.columnIndex].name,f);for(c=0;c<e.length;c++)e[c].className&&0<=e[c].className.indexOf("dg-th_sort")&&(e[c].className="dg-th dg-th_sort");d.className="dg-th dg-th_sort "+(f?"dg-th_asc":"dg-th_desc")}}else if("input"==e&&"checkbox"==d.type.toLowerCase()&&(b=a.allCells[d.parentNode.getAttribute("name")])){e=d.checked;for(c=0;c<a.rows.length;c++)(f=a.getDataGridCell(c,b.columnIndex))&&f._setValue(e);
c=a.id+"_"+a.columns[b.columnIndex].name;e=l.getElementsByName(c);for(c=0;c<e.length;c++)"checkbox"==e[c].type&&(e[c].checked=d.checked)}}});if(this._editable){var c=function(d){var e=d.previousSibling;!e&&d.parentNode.previousSibling&&(e=d.parentNode.previousSibling.lastChild);if(!e)return null;b=a.allCells[e.id];return 0<=t.indexOf(b.cellType)&&"none"!=e.style.display&&!a.columns[b.columnIndex].isPk||a.PKEditable?e:c(e)},e=function(c){var d=c.nextSibling;!d&&c.parentNode.nextSibling&&(d=c.parentNode.nextSibling.firstChild);
if(!d)return null;b=a.allCells[d.id];return 0<=t.indexOf(b.cellType)&&"none"!=d.style.display&&(!a.columns[b.columnIndex].isPk||a.PKEditable)?d:e(d)};l.getElementById(this.id).bind("keydown",function(g){if(a.enabled)if(n.lock)n.lock.focus&&n.lock.focus();else{var h=g.keyCode?g.keyCode:g.which,f=g.srcElement?g.srcElement:g.target;if(!(0>[13,27].indexOf(h)||0>["input","select","textarea"].indexOf(f.nodeName.toLowerCase()))){d=f.parentNode;b=a.allCells[d.id];b.inputObject&&b.inputObject.blur();switch(h){case 13:(d=
g.shiftKey?c(d):e(d))&&(b=a.allCells[d.id])&&b.focus()}return!1}}})}},_initHead:function(){},_initGridButtons:function(){if(this.buttons&&!(0>=this.buttons.length)){var a,d,b,c,e="",g="";for(a=0;a<this.buttons.length;a++)d=this.buttons[a].location,b=this.buttons[a].caption?this.buttons[a].caption:this.buttons[a].value,(c=this.buttons[a].onclick)&&0<c.length&&0>c.indexOf("(")&&(c+='(DataGrid.all["'+this.id+'"])'),"top"!=d||this.$top?(this.$bottom||(this.$bottom=l.createElement("div"),this.$bottom.className=
f.bottomDivClass,this._parentNode.appendChild(this.$bottom)),g+="<input type='button' value='"+b+"' onclick='"+c+"'>"):(this.$top||(this.$top=l.createElement("div"),this._parentNode.insertBefore(this.$top,this._parentNode.firstChild)),e+="<input type='button' value='"+b+"' onclick='"+c+"'>");this.$top&&(this.$top.innerHTML=e);this.$bottom&&(this.$bottom.innerHTML=g)}},_load:function(){this.lineNoColumn&&this._allocLineNo();var a,d,b,c;a=this._generateHeadRows();d=this._generateBodyRows();b="<div class='"+
(this.height?f.headDivScrollClass:f.headDivClass);b=b+"'><table id='"+this.id;b+="_head' class='";b+=f.headDataGridClass;b+="'><thead>";b+=a;b+="</thead></table></div>";c="<div class='"+(this.height?f.bodyDivScrollClass:f.bodyDivClass);c+=this.height?"' style='max-height:"+this.height+"px'>":"'>";c=c+"<table id='"+this.id;c+="' class='";c+=this._editable?"dg'><thead>":"dg-autoheight dg'><thead>";c+=a;c+="</thead><tbody>";c+=d;c+="</tbody></table></div>";this._parentNode.innerHTML=b+c;this.$head=l.getElementById(this.id+
"_head");this.$=l.getElementById(this.id)},_reload:function(){var a,d;this.$&&(this.allCells=null,this.allCells={},this._generateHeadRows(),a=this._generateBodyRows(),d=this.$.tBodies[0])&&(d.innerHTML=a)},reload:function(a){a=a?a:[];"string"===typeof a&&(a=JSON.parse(a));this.rows=a;this._reload()},_generateRowCells:function(a){return(a=(new r(this,a)).html)?a.substring(a.indexOf("<td"),a.lastIndexOf("</td>")+4):null},_generateHeadRows:function(){return this._generateRows(-1,1)},_generateBodyRows:function(){if(this.pageSize&&
!isNaN(this.pageSize)&&"offline"==this.pagingType){var a=(this.pageNum-1)*this.pageSize,d=this.pageSize,b=Math.ceil(this.rows.length/this.pageSize);if(this.pageNum>b)return"";this.pageNum==b&&(d=this.rows.length-(b-1)*this.pageSize);return this._generateRows(a,d)}return this._generateRows(0,this.rows.length)},_generateRows:function(a,d){for(var b,c="",e=a;e<a+d;e++)b=new r(this,e),c+=b.html;return c},createNewRow:function(a,d){var b,c;if(!this.onBeforeNewRow||eval(this.onBeforeNewRow+"(rowSource)"))if(a>
this.rows.length||isNaN(a)?a=this.rows.length:0>a&&(a=0),c=this.$.tBodies[0])return b=new r(this,this.rows.length),a==this.rows.length-1?c.insertAdjacentHTML("beforeend",b.html):this.concurMode?(c.insertAdjacentHTML("beforeend",b.html),this.moveRowTo(this.rows.length-1,a)):(c.rows[a].insertAdjacentHTML("beforebegin",b.html),this.lineNoColumn&&this.allocLineNo(a)),b=c.rows[a],this._onCreateRow(a,b,d),a},createContentRow:function(a,d,b){var c,e;d>this.rows.length||isNaN(d)?d=this.rows.length:0>d&&(d=
0);d<this.rows.length-1?this.$.rows[d].insertAdjacentHTML("beforebegin","<tr type='content'><td colspan='"+this.columns.length+"'></td></tr>"):this.$.tBodies[0].insertAdjacentHTML("beforeend","<tr type='content'><td colspan='"+this.columns.length+"'></td></tr>");c=this.$.rows[d];a&&(e=c.cells[0],"string"===typeof a?e.innerHTML=a:e.appendChild(a));this._onCreateRow(d,c,b);return c},_onCreateRow:function(a,d,b){d&&(b||(b=300),this.onNewRow&&eval(this.onNewRow+"(position, tr)"),this._focusRow(d),b?(d.style.display=
"none",d.style.opacity=.1,d.style.display="",this.$.parentNode.animate({scrollTop:d.offsetTop-f.headHeight},b,function(){d.style.opacity=1})):this.$.parentNode.scrollTop=d.offsetTop-f.headHeight)},_findRows:function(a,d,b){var c,e=[],g;isNaN(a)||(a=this.columns[a].name);if(a)for(c=0;c<this.rows.length&&!("delete"!=this.getRowStatus(c)&&(g=this.rows[c][a],g==d&&(e.push(c),b&&e.length>=b)));c++);return e},findRows:function(a,d,b){var c,e=[];isNaN(a)&&(a=this.getColumnIndexByName(a));if(0<=a)for(c=0;c<
this.rows.length&&!("delete"!=this.getRowStatus(c)&&this.getCellValue(c,a)==d&&(e.push(c),b&&e.length>=b));c++);return e},findRowsByWhere:function(a,d){var b,c=a,e=[],g=[],h=[],f;if("string"!=typeof a)return null;e=a.split("[");for(b=0;b<e.length;b++)0>=e[b].length||0>=e[b].indexOf("]")||(f=e[b].substr(0,e[b].indexOf("]")),g.push(f));for(b=0;b<g.length;b++)e=g[b],isNaN(e)&&(e=this.getColumnIndexByName(e)),c=c.replace(g[b],e);for(b=0;b<this.rows.length&&!(g=this.id+"_"+b+"_",g=c.replace(/\[/g,'document.getElementById("'+
g).replace(/\]/g,'").innerText'),eval(g)&&(h.push(b),d&&h.length>=d));b++);return h},findDuplicateRow:function(a,d){if(!a||0>=a.length)return null;var b,c=[],e,g,f,k;d||(d="|");b="string"===typeof a?a.split(d):a;for(f=0;f<b.length;f++)isNaN(b[f])&&(b[f]=this.getColumnIndexByName(b[f]));for(f=0;f<this.rows.length;f++)if("delete"!=this.getRowStatus(f)){e="";for(k=0;k<b.length;k++)(g=this.getCellValue(f,b[k]))&&(e+=(g?g:"")+d);if(0>c.index(e))c.push(e);else return f}return null},_blurRow:function(){var a=
[],d,a=l.getElementsByClassName?this.$.getElementsByClassName("dg-tr_focus"):l.querySelectorAll?this.$.querySelectorAll(".dg-tr_focus"):this.$.getElementsByTagName("tr");for(d=0;d<a.length;d++)a[d].className="dg-tr"},_focusRow:function(a){this._blurRow();a.className="dg-tr dg-tr_focus"},getFocusedRow:function(){var a,d,b;if(l.getElementsByClassName){if(a=this.$.getElementsByClassName("dg-tr_focus")[0])d=a.firstChild}else if(l.querySelector)d=this.$.querySelector(".dg-tr_focus td");else{a=this.$.getElementsByTagName("tr");
for(var c=0;c<a.length;c++)if(0<=a[c].className.indexOf("dg-tr_focus")){d=a[c].firstChild;break}}if(!d)return null;if(a=this.allCells[d.id])b=a.parentRow;return b?b.rowIndex:null},getRowStatus:function(a){return this.rows[a]?this.rows[a][f.rowStatus]:null},deleteRow:function(a,d){if(this.rows[a]){var b=this,c=this.getCell(a,0),e;c&&(e=c.parentNode,this.rows[a][f.rowStatus]="delete",d?(e.style.opacity=0,setTimeout(function(){e.remove();b.lineNoColumn&&b.allocLineNo()},d)):(e.remove(),b.lineNoColumn&&
b.allocLineNo()))}},deleteRows:function(a,d){var b;"string"===typeof a&&(a=a.split(","));if(this.lineNoColumn){for(b=0;b<a.length;b++){if(!this.rows[a[b]])return;this.rows[a[b]][f.rowStatus]="delete";this.getCell(a[b],0).parentNode.remove()}this.allocLineNo()}else for(b=0;b<a.length;b++)this.deleteRow(a[b],d)},deleteRowsByWhere:function(a,d){var b=this.findRowsByWhere(a);b&&this.deleteRows(b,d)},filterRows:function(a,d,b){var c=[];a=this._findRows(a,d);!b&&this.initRows&&(this.rows=JSON.parse(this.initRows));
this.initRows||(this.initRows=JSON.stringify(this.rows));if(a){for(b=0;b<a.length;b++)c.push(this.rows[a[b]]);this.rows=c;this._reload()}},filterRowsByWhere:function(a){},disableCell:function(a,d){this.setRowsCellEnabled(a,d,!1)},setRowsCellEnabled:function(a,d,b){if(a!=p){isNaN(d)&&(d=this.getColumnIndexByName(d));var c,e,f;"string"===typeof a&&(a=a.split(","));for(c=0;c<a.length;c++){e=this.getCellId(a[c],d);if(f=this.getDataGridCell(e))f.enabled=b;if((e=l.getElementById(e))&&!(0>=e.childNodes.length))for(f=
e.getElementsByTagName("input"),e=0;e<f.length;e++)f[e].disabled=!b}}},clearAllRows:function(){this.rows={};this._reload()},_exchange2Rows:function(a,d,b){if(!(0>a||a>this.rows.length-1||0>d||d>this.rows.length-1)){var c=this.lineNoColumn,e=this.rows[a],g,h,k=this.rows[a][f.rowStatus],m=this.rows[d][f.rowStatus];b||null==c||(g=this.rows[a][c],h=this.rows[d][c]);this.rows[a]=this.rows[d];this.rows[d]=e;!b&&c&&(g&&(this.rows[a][c]=g),h&&(this.rows[d][c]=h),k=this.rows[a][f.rowStatus],m=this.rows[d][f.rowStatus],
"insert"!=k&&"delete"!=k&&(this.rows[a][f.rowStatus]="update"),"insert"!=m&&"delete"!=k&&(this.rows[d][f.rowStatus]="update"))}},exchange2Rows:function(a,d,b){if("delete"!=this.rows[a][f.rowStatus]&&"delete"!=this.rows[d][f.rowStatus]){b||(b=0);var c=this,e=this.getCell(a,0).parentNode,g=this.getCell(d,0).parentNode;this._exchange2Rows(a,d);b?(e.style.opacity=0,g.style.opacity=0,setTimeout(function(){e.innerHTML=c._generateRowCells(a);g.innerHTML=c._generateRowCells(d);c._focusRow(g);e.style.opacity=
1;g.style.opacity=1},b)):(e.innerHTML=c._generateRowCells(a),g.innerHTML=c._generateRowCells(d),c._focusRow(g))}},moveRow:function(a,d){if(!(0>a||a>=this.rows.length)&&d&&0!=d){for(var b=0<d?1:-1,c=a,e=a+b;this.rows[e]&&0<Math.abs(d);)"delete"!=this.rows[e][f.rowStatus]&&(this._exchange2Rows(c,e),this.getCell(c,0).parentNode.innerHTML=this._generateRowCells(c),d-=b,c=e),e+=b;this.rows[c]||(c-=b);b=this.getCell(c,0).parentNode;b.innerHTML=this._generateRowCells(c);this._focusRow(b)}},moveRow1:function(){},
moveRowTo:function(a,d){this.moveRow(a,d-a)},getColumnIndexByName:function(a){var d,b;for(b=0;b<this.columns.length;b++)if((d=this.columns[b].name)&&d.toLowerCase()==a.toLowerCase())return b;return-1},getCellId:function(a,d){if(a==p||d==p)return null;isNaN(d)&&(d=this.getColumnIndexByName(d));return this.id+"_"+a+"_"+d},getCell:function(a,d){var b=this.getCellId(a,d);return l.getElementById(b)},getDataGridCell:function(a,d){var b=this.getCellId(a,d);return this.allCells[b]},getCellValue:function(a,
d){var b=this.getDataGridCell(a,d);return b?b.cellValue:null},setCellValue:function(a,d,b,c){(a=this.getDataGridCell(a,d))&&a.setValue(b,c)},setRowsCellValue:function(a,d,b){"string"===typeof a&&(a=a.split(","));isNaN(d)&&(d=this.getColumnIndexByName(d));if(0<=d)for(var c=0;c<a.length;c++){var e=this.getDataGridCell(a[c],d);e&&e.setValue(b)}},setAllRowsCellValue:function(a,d){var b,c;isNaN(a)&&(a=this.getColumnIndexByName(a));for(c=0;c<this.rows.length;c++)(b=this.getDataGridCell(c,a))&&b.setValue(d)},
setRowsCellValueByWhere:function(a,d,b){a=this.findRowsByWhere(a);isNaN(d)&&(d=this.getColumnIndexByName(d));a&&this.setRowsCellValue(a,d,b)},focusCell:function(a,d){var b=this.getDataGridCell(a,d);b&&b.focus()},_sort:function(a,d){function b(a,b){if(!a&&!b)return!1;if(!a)return!d;if(!b)return d;if(a==b)return!1;isNaN(a)||isNaN(b)?(a=a.toLowerCase(),b=b.toLowerCase()):(a=parseFloat(a),b=parseFloat(b));return d?a>b:a<b}isNaN(a)||(a=this.columns[a].name);if(a){var c,e,f;for(c=1;c<this.rows.length;c++){e=
c-1;for(f=this.rows[c];0<=e&&b(this.rows[e][a],f[a]);)this.rows[e+1]=this.rows[e],e--;this.rows[e+1]=f}}},sort:function(a,d){this._sort(a,d);this._allocLineNo();this._reload()},_allocLineNo:function(a,d){if(this.lineNoColumn){if(a==p||0>a)a=0;d==p&&(d=a+1);var b,c=d;for(b=a;b<this.rows.length;b++)"delete"!=this.rows[b][f.rowStatus]&&(this.rows[b][this.lineNoColumn]=c++)}},allocLineNo:function(a,d){if(this.lineNoColumn){if(a==p||0>a)a=0;d==p&&(d=a+1);var b=this.getColumnIndexByName(this.lineNoColumn),
c,e,g,h=d;if(this.concurMode)for(c=a;c<this.rows.length;c++)"delete"!=this.rows[c][f.rowStatus]&&(e=this.getDataGridCell(c,b),e.setValue(h++));else for(g=this.$.tBodies[0],c=a;c<g.rows.length;c++)e=parseInt(g.rows[c].cells[0].id.slice(-3,-2)),"delete"!=this.rows[e][f.rowStatus]&&(e=this.getDataGridCell(e,b),e.setValue(h++))}},refreshColumn:function(a,d,b){},setColumnAttribute:function(a,d,b){isNaN(a)&&(a=this.getColumnIndexByName(a));0>a||(this.columns[a][d]=b,this._initColumns(),this._reload())},
setColumnsAttributes:function(a){if(a&&!(0>=a.length)){var d,b;for(d=0;d<a.length;d++){var c=null;if(a[d].index)c=a[d].index;else if(a[d].name)c=this.getColumnIndexByName(a[d].name);else continue;if(!(0>c))for(b in a[d])"index"!=b&&"name"!=b&&(this.columns[c][b]=a[d][b])}this._initColumns();this._reload()}},setColumnOptions:function(a,d){if(d&&(isNaN(a)&&(a=this.getColumnIndexByName(a)),!(0>a))){var b=this.columns[a].type;if("select"==b||"map"==b)"string"===typeof d&&(d=JSON.parse(d)),this.columns[a].options=
d,this._initColumns(),this._reload()}},setCellOptions:function(a,d,b){var c=this.columns[d].type,e;if(b&&(isNaN(d)&&(d=this.getColumnIndexByName(d)),!(0>d||"select"!=c&&"map"!=c))){"string"===typeof b&&(b=JSON.parse(b));c="<select>";for(e=0;e<b.length;e++)c+="<option value='"+b[e].value+"'>"+b[e].text+"</option>";c+="</select>";if(a=this.getDataGridCell(a,d))a.cellOptions=b,a.cellSelect=c}},getDataSource:function(){if(!this.enableRowStatus){var a,d=JSON.parse(JSON.stringify(this.rows));for(a=0;a<
d.length;a++)"delete"==d[a][f.rowStatus]&&d.splice(a--,1);return JSON.stringify(d)}return JSON.stringify(this.rows)},getRows:this.getDataSource,save:function(){},_initColumnValidation:function(a){var d,b,c="",e="",g,h,k,m,l;g=this.columns[a];d=g[f.validateCode];if(!d)return null;a=g[f.validateMessage];d&&"%"==d.substr(0,1)&&(b=g.caption,b||(b=g.name),h=d.substr(1,1),"I"==h?(k=d.indexOf("("),m=d.indexOf(")"),e=0>k?d.substring(2):d.substring(2,k),0<=e.indexOf("n")&&(c+="^$|"),0<=e.indexOf("+")?(c+=
"^[1-9]",e=b+": Positive Integer"):0<=e.indexOf("0")?(c+="^0$|^[1-9]",e=b+": Non-Negative Integer"):(c+="^[+-]?[0-9]",e=b+": Integer"),0>k||0>m?c+="[0-9]*":(d=parseInt(d.substring(k+1,m),10),1<d&&(c+="[0-9]{0,"+(d-1).toString()+"}"),e+=" (Precision:"+d.toString()+")"),c+="$",e+=" required."):"F"==h?(k=d.indexOf("("),m=d.indexOf(")"),e=0>k?d.substring(2):d.substring(2,k),0<=e.indexOf("n")&&(c+="^$|"),0<=e.indexOf("+")||0<=e.indexOf("0")?(c+="^",e=b+": Positive Float"):(c+="^[+-]?",e=b+": Float"),0>
k||0>m?c+="[0-9]*(\\.[0-9]+)?":(l=d.substring(k+1,m),k=l.indexOf("."),0>k?(d=parseInt(l,10),m=0):(d=parseInt(l.substring(0,k),10),m=parseInt(l.substring(k+1),10)),1<=d?(1<d&&(c+="[0-9]{0,"+(d-1).toString()+"}"),e+=" (Precision: "+d.toString()):(c+="[0-9]*",e+=" (Precision: unlimit"),0<m?(c+="(\\.[0-9]{1,"+m.toString()+"})?",e+=", Scale: "+m.toString()+")"):(c+="(\\.[0-9]+)?",e+=", Scale: unlimit)")),c+="$",e+=" required."):"C"==h&&(k=d.indexOf("("),m=d.indexOf(")"),0<=k&&0<m&&(l=d.substring(k+1,m),
k=l.indexOf("-"),0>k?(d=0,m=parseInt(l,10)):(d=parseInt(l.substring(0,k),10),m=k+1==m?0:parseInt(l.substring(k+1),10)),c="^.{"+d.toString()+","+(0<m?m.toString():"")+"}$",e=b+": "+d.toString()+"-"+(0<m?m.toString():"unlimit")+" characters.")),"D"==h?e="Date required.":g[f.validateCode]=c,a||(g[f.validateMessage]=e))},validate:function(a){var d,b,c,e=[],g,h=[];for(d=0;d<this.columns.length;d++)(b=this.columns[d][f.validateCode])&&0<b.length&&e.push(d);if(!e.length)return!0;for(d=0;d<this.rows.length;d++)if("delete"!=
this.rows[d][f.rowStatus])for(b=0;b<e.length;b++){c=this.getDataGridCell(d,e[b]);g=c.validate(p,!a);if(!g&&!a)return!1;g||h.push(c)}return 0<h.length?(alert(h.length+" fail"),!1):!0}};var r=function(a,d){this._generateRow(a,d)};r.prototype={parentGrid:null,rowIndex:null,html:null,_generateRow:function(a,d){var b=a.columns,c={},e,g="",h;this.parentGrid=a;this.rowIndex=d;if(d>=a.rows.length){c[f.rowStatus]="insert";if(a.lineNoColumn){e=0;for(h=a.rows.length-1;0<h;h--)if("delete"!=a.rows[h][f.rowStatus]){e=
parseInt(a.rows[h][a.lineNoColumn]);isNaN(e)&&(e=0);break}c[a.lineNoColumn]=e+1}for(h=0;h<b.length;h++)b[h]["default"]?c[b[h].name]=b[h]["default"]:"checkbox"==b[h].type&&(c[b[h].name]=!1);a.rows.push(c)}e=0<=d&&0<a.rows.length&&"delete"==a.rows[d][f.rowStatus];for(h=0;h<b.length;h++)c=new u(this,h),g+=c.html;b="<tr class='dg-tr'"+(e?" style='display:none'>":">")+g;this.html=b+="</tr>"}};var u=function(a,d){this._generateCell(a,d)};u.prototype={parentRow:null,columnIndex:null,cellValue:null,cellText:null,
cellType:null,id:null,html:null,inputObject:null,labelObject:null,enabled:!0,_generateCell:function(a,d){var b,c,e="";c=a.parentGrid.columns[d];this.parentRow=a;this.columnIndex=d;this.id=a.parentGrid.id+"_"+a.rowIndex+"_"+d;this.cellType=c.type;c.hidden&&(e+="display:none;");if(0>a.rowIndex)c.width&&(e+="width:"+c.width+";"),b="<th class='dg-th"+(c.enableSorting?" dg-th_sort'":"'"),b=b+(""==e?"":" style='"+e+"'")+(this.id?" name='"+this.id+"'":""),b+=c.caption?" title='"+c.caption+"'>":">",b+="checkbox"==
this.cellType&&1==c.selectall?"<input type='checkbox' class='dg-th-checkbox'>":"",b+=c.caption?c.caption:"&nbsp;",b+="</th>";else{b=a.parentGrid.rows[a.rowIndex];c.onrender&&eval(c.onrender+"("+a.rowIndex+", parentRow.parentGrid)");b&&c.name&&(this.cellValue=this.cellText=b[c.name]);if(0==this.cellValue||0==this.cellValue)this.cellValue=this.cellValue.toString();c.align&&(e+="text-align:"+c.align);b="<td class='dg-td'";b+=""==e?"":" style='"+e+"'";b+=this.id?" id='"+this.id+"'":"";b+="label"==this.cellType?
" title='"+this.cellValue+"'>":">";b+=this._generateCellElement();b+="</td>"}this.html=b;a.parentGrid.allCells[this.id]=this},_generateCellElement:function(){var a=this.parentRow.rowIndex,d=this.cellType,b=this.parentRow.parentGrid.columns[this.columnIndex],c="";"datetime"==d&&(d="datetime-local");"textfield"==d&&(d="textarea");switch(d){case "checkbox":case "radio":c="<input type='"+d+"' name='";c+=this.parentRow.parentGrid.id+"_"+b.name;c+="' value='";c+=a;c+="1"==this.cellValue?"' checked='checked'/>":
"'/>";break;case "button":case "jsonform":b.buttons&&(c=b.buttons.replace(/#/g,a));break;case "image":c="<input type='"+d;c+="' src='";c+=this.cellValue;c+="' class='dg-image' />";break;case "link":d=b.alias?b.alias:this.cellValue?this.cellValue:"&nbsp;";b.onclick?(c="<a onclick='"+b.onclick,c+="("+a+")' class='dg-a'>"):(c="<a href='"+this.cellValue,c+="' class='dg-a'>");c+=d;c+="</a>";break;case "map":case "select":if((a=this.cellOptions?this.cellOptions:b.options)&&0<a.length)for(c=0;c<a.length;c++)if(this.cellValue==
a[c].value){this.cellText=a[c].text;break}c=this.cellText?this.cellText:"&nbsp;";break;case "progress":a=parseFloat(this.cellValue);isNaN(a)&&(a=0);c=a=Math.round(100*a);100<c?c=100:0>c&&(c=0);b="<span class='"+(0<a&&10>=a?f.emptyProClass:30>=a?f.warningProClass:f.enoughProClass)+"' style='width:"+c+"%'>&nbsp;</span><span class='"+f.restProClass+"' style='width:"+(100-c)+"%'>&nbsp;</span><span class='"+f.proTitleClass+"'>"+a+"%</span>";c="<span class='"+f.proClass;c+="' title='";c+=a+"%'>";c+=b;c+=
"</span>";break;default:c=this.cellValue?this.cellValue:"&nbsp;"}return c},_onClick:function(){var a=this.cellType,d=l.getElementById(this.id),b,c,e=this,f=!1,h;if(d&&(this.parentRow.parentGrid._focusRow(d.parentNode),!(0>t.indexOf(a))&&this.enabled))if(b=this.inputObject,c=this.labelObject,h=this.parentRow.parentGrid.columns[this.columnIndex],!this.parentRow.parentGrid.PKEditable&&h.isPk)alert("Can't edit Primary Key");else{this.cellOptions&&(f=!0);if(!b||f){switch(a){case "text":case "date":case "datetime-local":case "time":case "number":case "email":case "tel":case "url":d.innerHTML=
"<span></span>";c=d.firstChild;b=l.createElement("input");b.type=a;b.className="dg-input";b.value=e.cellValue?e.cellValue:"";d.appendChild(b);b.onblur=function(){e._setValueByInput(b)&&(b.style.display="none",c.innerText=b.value,c.style.display="",d.className="dg-td")};break;case "textarea":d.innerHTML="<span></span>";c=d.firstChild;b=l.createElement("textarea");b.value=e.cellValue?e.cellValue:"";b.className="dg-textarea";d.appendChild(b);b.onfocus=function(){b.autoHeight()};b.onchange=function(){b.autoHeight()};
b.onkeyup=function(){b.autoHeight()};b.onblur=function(){e._setValueByInput(b)&&(b.style.display="none",c.innerText=b.value,c.style.display="",d.className="dg-td")};break;case "select":h=e.cellSelect?e.cellSelect:h.select?h.select:"<select></select>";d.innerHTML="<span></span>";c=d.firstChild;d.insertAdjacentHTML("beforeend",h);b=d.getElementsByTagName("select")[0];b.className="dg-select";b.onblur=function(){e._setValueByInput(b.options[b.selectedIndex])&&(b.style.display="none",c.innerText=b.options[b.selectedIndex].text,
c.style.display="",d.className="dg-td")};b.value=e.cellValue;break;case "checkbox":(h=d.getElementsByTagName("input")[0])&&e._setValue(h.checked);break;case "radio":for(var f=d.getElementsByTagName("input")[0],k=this.parentRow.parentGrid.rows,a=0;a<k.length;a++)k[a][h.name]&&(k[a][h.name]=!1);k[this.parentRow.rowIndex]&&(k[this.parentRow.rowIndex][h.name]=f.checked)}e.inputObject=b;e.labelObject=c}c&&b&&(b.style.display="",b.focus(),c.style.display="none",d.className="dg-td dg-td_inputting")}},focus:function(){if(0<=
w.indexOf(this.cellType))this._onClick();else{var a=l.getElementById(this.id);a.firstChild&&a.firstChild.focus()}},setValue:function(a){this.inputObject&&(this.inputObject.blur(),this.inputObject.remove(),this.inputObject=null);this._setValue(a);this._render(a)},_setValue:function(a,d){var b=this.parentRow.rowIndex,c=this.parentRow.parentGrid.columns[this.columnIndex],e=this.parentRow.parentGrid.rows,g;this.cellValue!=a&&(e[b]&&(g=e[b][f.rowStatus],e[b][c.name]=a,"insert"!=g&&"delete"!=g&&(e[b][f.rowStatus]=
"updated")),this.cellValue=this.cellText=a,d||(c=c.onchange)&&eval(c+"("+b+",'"+a+"','"+this.cellValue+"')"))},_setValueByInput:function(a){if(!this.validate(a.value,!0))return n.lock=a,!1;this._setValue(a.value);n.lock=!1;return!0},_render:function(a){var d,b;switch(this.cellType){case "checkbox":case "radio":(d=l.getElementById(this.id))&&(b=d.getElementsByTagName("input")[0]);b&&(b.checked=a&&"0"!=a);break;case "map":case "select":d=this.parentRow.parentGrid.columns[this.columnIndex];if(a=this.cellOptions?
this.cellOptions:d.options)for(d=0;d<a.length;d++)if(this.cellValue==a[d].value){this.cellText=a[d].text;break}if(d=l.getElementById(this.id))(a=d.getElementsByTagName("span")[0])?a.innerHTML=this.cellText?this.cellText:"&nbsp;":d.innerHTML=this.cellText?this.cellText:"&nbsp;";break;case "button":case "image":case "link":break;default:if(d=l.getElementById(this.id))(a=d.getElementsByTagName("span")[0])?a.innerHTML=this.cellText?this.cellText:"&nbsp;":d.innerHTML=this.cellText?this.cellText:"&nbsp;"}},
validate:function(a,d){function b(a,b,c){b=b.indexOf(c);if(0>b)return-1;a=parseInt(a.substr(b,c.length),10);return isNaN(a)?-1:a}function c(a,c){var d,e,f,g;d=b(a,c,"YYYY");if(0>d){d=b(a,c,"YY");if(0>d)return null;d+=2E3}e=b(a,c,"MM");if(1>e||12<e)return null;f=b(a,c,"DD");if(1>f)return null;g=31;if(2==e){if(g=28,0==d%4&&0!=d%100||0==d%400)g=29}else if(2==e||4==e||6==e||9==e||11==e)g=30;return f>g?null:new Date(d,e-1,f)}var e,g,h;if(null==a||a==p)a=this.cellValue;e=this.parentRow.parentGrid.columns[this.columnIndex];
h=e[f.validateCode];g=e[f.validateFunction];e=e[f.validateMessage];if(g&&"undefined"!=eval("typeof("+g+")")&&!eval(g+"("+this.parentRow.rowIndex+", value)"))return e&&d&&(alert(e),this.focus()),!1;if(h)if("%D"==h.substr(0,2)){if("%DN"!=h.substr(0,3)||null!=a&&""!=a)if(g=h.substring(h.indexOf("(")+1,h.lastIndexOf(")")),null==c(a,g))return e&&d&&(alert(e),this.focus()),!1}else if(g=new RegExp(h),!g.exec(a))return e&&d&&(alert(e),this.focus()),!1;return!0}};var f={gridDivClass:"dgroot-div",headDivClass:"dghead-div",
headDivScrollClass:"dghead-div-y",bodyDivClass:"dgbody-div",bodyDivScrollClass:"dgbody-div-y",bottomDivClass:"dgbottom-div",dataGridClass:"dg",headDataGridClass:"dg dg-head",autoHeightClass:"autoheightrow",headTrClass:"dg-h-tr",bodyTrClass:"dg-tr",focusTrClass:"dg-tr_focus",thClass:"dg-th",sortThClass:"dg-th_sort",ascThClass:"dg-th_asc",descThClass:"dg-th_desc",tdClass:"dg-td",contentTdClass:"dg-td_content",inputTdClass:"dg-td_ctrl",waitingDivClass:"dg-td_wait",inputClass:"dg-input",textClass:"dg-text",
CheckClass:"dg-checkbox",radioClass:"dg-radio",imageClass:"dg-image",buttonClass:"dg-button",selectClass:"dg-select",textareaClass:"dg-textarea",aClass:"dg-a",spanClass:"dg-span",thSpanClass:"dg-th-span",proClass:"dg-span_pro",emptyProClass:"dg-span_pro_alert",warningProClass:"dg-span_pro_warn",enoughProClass:"dg-span_pro_regular",restProClass:"dg-span_pro_rest",proTitleClass:"dg-span_pro_title",pagingClass:"datagridpaging",nextPageClass:"nextpage",prevPageClass:"prevpage",defaultColumns:"columns",
defaultButtons:"buttons",defaultAttributes:"attributes",defaultRows:"rows",rowStatus:"rowstatus",validateFunction:"validatefunc",validateCode:"validate",validateMessage:"validatemsg",autoBottomMargin:40,headHeight:34,adjPageLinkCount:5},v={bodyDivClass:"datagridbody-div-s",bodyDivScrollClass:"datagridbody-div-y-s",dataGridClass:"datagrid-s datagrid",headDataGridClass:"datagrid-s datagrid datagrid-head"},w="text date datetime-local time number email tel url select textarea".split(" "),t="text date datetime-local time number email tel url select textarea checkbox radio button".split(" ");
q.DataGrid=n;l.writeln('<link rel="Stylesheet" href="'+q.getRootPath()+'/css/datagrid.3.0.css" />')})(window,document);